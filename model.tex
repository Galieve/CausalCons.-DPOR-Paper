\section{Causally closed models}

Besides models presented in figure \ref{fig:consistency_defs}, others isolation levels exists in literature and real life applications \textcolor{red}{cite Constantin's papers + Twitter, shoppingcart...}. However, our algorithm can not be analyzed under an arbitrary model. We characterize in this section the ones that can be employed by our algorithm.
%not all of them can verified with the algorithm

\begin{figure}[H]
	
	\centering
	\begin{subfigure}[b]{.25\textwidth}
		\resizebox{\textwidth}{!}{
			\begin{tikzpicture}[->,>=stealth',shorten >=1pt,auto,node distance=3cm,
				semithick, transform shape]
				\node[draw, rounded corners=2mm,outer sep=0] (t1) at (-3.25, 0) {\begin{tabular}{l} $\wrt{x}{0}$ \\ $\wrt{y}{0}$ \end{tabular}};
				\node[draw, rounded corners=2mm,outer sep=0] (t2) at (-3.25, -2) {\begin{tabular}{l} 
						$a \gets \rd{x}$ \pgfsetfillopacity{0.3}\\ $b \gets \rd{y}$
				\end{tabular}};
				\node[draw, rounded corners=2mm,outer sep=0] (t3) at (0, 0) {\begin{tabular}{l} 
						$\wrt{x}{2}$%\\
						%\pgfsetfillopacity{0.3}$\wrt{y}{2}$
				\end{tabular}};			
				
				\path (t1.south west) -- (t1.south) coordinate[pos=0.67] (t1x);
				\path (t2.north west) -- (t2.north) coordinate[pos=0.67] (t2x);
				\path (t3.north west) -- (t3.west) coordinate[pos=0.67] (t3x);
				
				\path (t3x) edge [above] node[yshift=8,xshift=0] {$\wro_x$} (t2.north east);
				%\path (t1x) edge [right] node {$\wro_y$} (t2x);
			\end{tikzpicture}  
			
		}
		\caption{Extensible history.}
		\label{fig:maxclosed:a}
	\end{subfigure}
	\hspace{.75cm}
	\centering
	\begin{subfigure}[b]{.25\textwidth}
		\resizebox{\textwidth}{!}{
			\begin{tikzpicture}[->,>=stealth',shorten >=1pt,auto,node distance=3cm,
				semithick, transform shape]
				\node[draw, rounded corners=2mm,outer sep=0] (t1) at (-3.25, 0) {\begin{tabular}{l} $\wrt{x}{0}$ \\ $\wrt{y}{0}$ \end{tabular}};
				\node[draw, rounded corners=2mm,outer sep=0] (t2) at (-3.25, -2) {\begin{tabular}{l} 
						$a \gets \rd{x}$ \\ $b \gets \rd{y}$
				\end{tabular}};
				\node[draw, rounded corners=2mm,outer sep=0] (t3) at (0, 0) {\begin{tabular}{l} 
						$\wrt{x}{2}$\pgfsetfillopacity{0.3}\\
						$\wrt{y}{2}$
				\end{tabular}};			
				
				\path (t1.south west) -- (t1.south) coordinate[pos=0.67] (t1x);
				\path (t2.north west) -- (t2.north) coordinate[pos=0.67] (t2x);
				\path (t3.north west) -- (t3.west) coordinate[pos=0.67] (t3x);
				
				\path (t3x) edge [above] node[yshift=8,xshift=0] {$\wro_x$} (t2.north east);
				\path (t1x) edge [right] node {$\wro_y$} (t2x);
			\end{tikzpicture}
			
		}
		\caption{Non-extensible history.}
		\label{fig:maxclosed:b}
	\end{subfigure}
	\hspace{.175cm}
	\centering
	\caption{Example of a dead-lock after swapping two events.}
	\label{fig:maxclosed}
	%\vspace{-3mm}
\end{figure}

Let's analyze the histories $h_1$ and $h_2$ described in figure \ref{fig:maxclosed:a} and \ref{fig:maxclosed:b} respectively under RA; isolation level under which both are consistent. $h_1$ can be extended adding the event $r_1 = b \gets \rd{y}$ and the $\wro$-edge $w_1 \ [\wro] \ r_1$, where $w_1 = \wrt{x}{0}$. However, this is not the case of $h_2$: the only event that could be added in it is $w_2 = \wrt{y}{2}$. If $w_2$ would be added in $h_2$, any relation extending $\so \cup \wro$ and satisfying RA would be cyclic, so it wouldn't be a commit order. The essential difference between these two histories is the following: in $h_1$, $\tr(r)$ is $\so \cup \wro$-maximal while in $h_2$ $\tr(w)$ is not. As real database executions forbid transactions reading from non-committed ones, it is reasonable to allow those transactions $\so \cup \wro$-maximal to be executed completed without hindering the previous committed transactions. 

\begin{definition}
A model $\mathcal{M}$ is called \callout{causally closed} if for every program $\mathcal{P}$ the following conditions are satisfied:
\begin{itemize}
	%\item \textbf{Well-formedness:} Consistency criteria for a history $h$ only depend on the edges of $h$ and if $h$ is consistent then $[\so \cup \wro]^+$ is also acyclic.
	
	\item \textbf{Prefix-closedness:} Every $\so \cup \wro$-prefix-closed sub-history of a consistent history is also consistent.
	\item \textbf{Causal-extensibility:} Every non-total consistent history $h$ can be consistently extended by executing an event from a $\so \cup \wro$-maximal pending transaction $T$ in $h$. Moreover, if that event $r$ is a $\iread$, it can always read from a $\iwrite$ event $w$ s.t. in $h$ $\tr(w) \ [\so \cup \wro]^* \ \tr(r)$.
\end{itemize}
\end{definition}
%For be denominated as \callout{STMC-model}, $\mathcal{M}$ has to satisfies the following three axioms for every program $\mathcal{P}$:

Comparing to the model requirements described in \textcolor{red}{cite viktor's algorithm}, it is causal-extensibility property, a slightly stricter version of \textcolor{red}{Viktor}'s maximal-extensibility, the biggest difference. However, this weak formulation still forbids some axiomatic models such as Serializability \textcolor{red}{cite constantin's paper (SER)} \textcolor{red}{Appendix cite}.
%Indeed, some isolation levels cannot guarantee that reading from the last added $\iwrite$ event will maintain its consistency status.

\input{proofs:causal-extensibility}
